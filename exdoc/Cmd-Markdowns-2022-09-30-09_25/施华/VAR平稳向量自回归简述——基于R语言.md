# VAR平稳向量自回归简述——基于R语言

标签（空格分隔）： 施华

---

VAR是多元时间序列的一个经典模型，本文不详述相关理论，主要以$VAR(2)$为例，基于R语言来做一个简单介绍，本文忽略了比较繁琐的相关变量平稳性和残差交叉相关性检验。


### 实例背景
分析英国，加拿大和美国季度GDP增长率的关系，以$VAR(2)$为基础模型。


### 1.模型描述
$$Z_{t}=\beta_{0}+\beta_{t-1}Z_{t-1}+\beta_{2}Z_{t-2}+a_{t}$$
未做参数简化的实例模型为
$$Z_{t}=
\left[
\begin{array}{c}
0.1\\0.12\\0.29
\end{array}
\right]
+\left[
\begin{array}{ccc}
0.38&0.10&0.05\\
0.35&0.34&0.47\\
0.49&0.24&0.24
\end{array}
\right]Z_{t-1}
+\left[
\begin{array}{ccc}
0.06&0.11&0.02\\
-0.19&-0.18&-0.01\\
0.31&-0.13&0.09
\end{array}
\right]Z_{t-2}
+a_{t}$$
其中的残差协方差矩阵为
$$\hat \Sigma_{a}=
\left[\begin{array}{ccc}0.28&0.03&0.07\\
0.03&0.29&0.14\\
0.07&0.14&0.36
\end{array}
\right]$$



### 2.模型的参数估计
常用的VAR模型参数估计有LS、ML，常用MTS包中的VAR命令。另一个比较流行的估计方法为贝叶斯估计，常用MTS包中BVAR命令。
**R语言实例代码注释**
```R
m1=VAR(z,2)  ### VAR参数估计
Constant term: 
Estimates:  0.1258163 0.1231581 0.2895581 
Std.Error:  0.07266338 0.07382941 0.0816888 
AR coefficient matrix 
AR( 1 )-matrix 
      [,1]  [,2]   [,3]
[1,] 0.393 0.103 0.0521
[2,] 0.351 0.338 0.4691
[3,] 0.491 0.240 0.2356
standard error 
       [,1]   [,2]   [,3]
[1,] 0.0934 0.0984 0.0911
[2,] 0.0949 0.1000 0.0926
[3,] 0.1050 0.1106 0.1024
AR( 2 )-matrix 
        [,1]   [,2]     [,3]
[1,]  0.0566  0.106  0.01889
[2,] -0.1914 -0.175 -0.00868
[3,] -0.3120 -0.131  0.08531
standard error 
       [,1]   [,2]   [,3]
[1,] 0.0924 0.0876 0.0938
[2,] 0.0939 0.0890 0.0953
[3,] 0.1038 0.0984 0.1055
  
Residuals cov-mtx: 
           [,1]       [,2]       [,3]
[1,] 0.28244420 0.02654091 0.07435286
[2,] 0.02654091 0.29158166 0.13948786
[3,] 0.07435286 0.13948786 0.35696571
  
det(SSE) =  0.02258974 
AIC =  -3.502259 
BIC =  -3.094982 
HQ  =  -3.336804 
```


### 3.模型调参
VAR模型很容易产生很多参数，有些参数是不显著的，实际上没什么意义，R语言的MTS包中提供了refVAR命令来简化模型，
```R
m2=refVAR(m1,thres=1.96)
Constant term: 
Estimates:  0.1628247 0 0.2827525 
Std.Error:  0.06814101 0 0.07972864 
AR coefficient matrix 
AR( 1 )-matrix 
      [,1]  [,2]  [,3]
[1,] 0.467 0.207 0.000
[2,] 0.334 0.270 0.496
[3,] 0.468 0.225 0.232
standard error 
       [,1]   [,2]   [,3]
[1,] 0.0790 0.0686 0.0000
[2,] 0.0921 0.0875 0.0913
[3,] 0.1027 0.0963 0.1023
AR( 2 )-matrix 
       [,1] [,2] [,3]
[1,]  0.000    0    0
[2,] -0.197    0    0
[3,] -0.301    0    0
standard error 
       [,1] [,2] [,3]
[1,] 0.0000    0    0
[2,] 0.0921    0    0
[3,] 0.1008    0    0
  
Residuals cov-mtx: 
           [,1]       [,2]       [,3]
[1,] 0.29003669 0.01803456 0.07055856
[2,] 0.01803456 0.30802503 0.14598345
[3,] 0.07055856 0.14598345 0.36268779
  
det(SSE) =  0.02494104 
AIC =  -3.531241 
BIC =  -3.304976 
HQ  =  -3.439321 
```
还有一个参数需要调整的就是滞后阶数，R语言MTS包中的VARorder可以实现阶数的选择。
```R
z1=z/100
> m2=VARorder(z1)
selected order: aic =  2 
selected order: bic =  1 
selected order: hq =  1 
Summary table:  
       p      AIC      BIC       HQ     M(p) p-value
 [1,]  0 -30.9560 -30.9560 -30.9560   0.0000  0.0000
 [2,]  1 -31.8830 -31.6794 -31.8003 115.1329  0.0000
 [3,]  2 -31.9643 -31.5570 -31.7988  23.5389  0.0051
 [4,]  3 -31.9236 -31.3127 -31.6754  10.4864  0.3126
 [5,]  4 -31.8971 -31.0826 -31.5662  11.5767  0.2382
 [6,]  5 -31.7818 -30.7636 -31.3682   2.7406  0.9737
 [7,]  6 -31.7112 -30.4893 -31.2148   6.7822  0.6598
 [8,]  7 -31.6180 -30.1925 -31.0389   4.5469  0.8719
 [9,]  8 -31.7570 -30.1279 -31.0952  24.4833  0.0036
[10,]  9 -31.6897 -29.8569 -30.9451   6.4007  0.6992
[11,] 10 -31.5994 -29.5630 -30.7721   4.3226  0.8889
[12,] 11 -31.6036 -29.3636 -30.6936  11.4922  0.2435
[13,] 12 -31.6183 -29.1746 -30.6255  11.8168  0.2238
[14,] 13 -31.6718 -29.0245 -30.5964  14.1266  0.1179
> names(m2)
[1] "aic"   "aicor" "bic"   "bicor" "hq"    "hqor"  "Mstat" "Mpv"  
```



### 4.模型预测
这里直接给出R语言实例代码,用MTS包中的VARpred命令实现。
```R
VARpred(m1,8)  
orig  125 
Forecasts at origin:  125 
         uk      ca     us
[1,] 0.3129 0.05166 0.1660
[2,] 0.2647 0.31687 0.4889
[3,] 0.3143 0.48231 0.5205
[4,] 0.3839 0.53053 0.5998
[5,] 0.4412 0.56978 0.6297
[6,] 0.4799 0.59478 0.6530
[7,] 0.5068 0.60967 0.6630
[8,] 0.5247 0.61689 0.6688
Standard Errors of predictions:  
       [,1]   [,2]   [,3]
[1,] 0.5315 0.5400 0.5975
[2,] 0.5804 0.7165 0.7077
[3,] 0.6202 0.7672 0.7345
[4,] 0.6484 0.7785 0.7442
[5,] 0.6629 0.7824 0.7475
[6,] 0.6692 0.7838 0.7484
[7,] 0.6719 0.7842 0.7486
[8,] 0.6729 0.7843 0.7487
Root mean square errors of predictions:  
       [,1]   [,2]   [,3]
[1,] 0.5461 0.5549 0.6140
[2,] 0.6001 0.7799 0.7499
[3,] 0.6365 0.7879 0.7456
[4,] 0.6601 0.7832 0.7484
[5,] 0.6689 0.7841 0.7488
[6,] 0.6719 0.7844 0.7488
[7,] 0.6730 0.7844 0.7487
[8,] 0.6734 0.7844 0.7487
```


### 5.脉冲响应函数
VAR模型最实用的就是脉冲响应函数，该方法实质上是探索变量之间的关系，看一个变量变化对另一个变量的影响有多少。
```R
> Phi=m2$Phi
> Sig=m2$Sigma
> VARirf(Phi,Sig)
> VARirf(Phi,Sig,orth=F)
```
预测方差分解
```R
m2=refVAR(m1)  
Constant term: 
Estimates:  0.1432855 0.1222856 0.2981361 
Std.Error:  0.06905416 0.07289371 0.08087773 
AR coefficient matrix 
AR( 1 )-matrix 
      [,1]  [,2]  [,3]
[1,] 0.434 0.151 0.000
[2,] 0.351 0.335 0.469
[3,] 0.492 0.269 0.233
standard error 
       [,1]   [,2]   [,3]
[1,] 0.0817 0.0779 0.0000
[2,] 0.0945 0.0941 0.0921
[3,] 0.1049 0.1044 0.1022
AR( 2 )-matrix 
       [,1]    [,2] [,3]
[1,]  0.000  0.1176    0
[2,] -0.193 -0.1781    0
[3,] -0.293 -0.0986    0
standard error 
      [,1]   [,2] [,3]
[1,] 0.000 0.0790    0
[2,] 0.091 0.0808    0
[3,] 0.101 0.0897    0
  
Residuals cov-mtx: 
           [,1]       [,2]       [,3]
[1,] 0.28472577 0.02649555 0.07479875
[2,] 0.02649555 0.29160249 0.13928307
[3,] 0.07479875 0.13928307 0.35897902
  
det(SSE) =  0.02294983 
AIC =  -3.566445 
BIC =  -3.2723 
HQ  =  -3.446949 
> names(m2)
 [1] "data"      "order"     "cnst"      "coef"      "aic"       "bic"      
 [7] "hq"        "residuals" "secoef"    "Sigma"     "Phi"       "Ph0"      
> Phi=m2$Phi
> Sig=m2$Sigma
> Theta=NULL
> FEVdec(Phi,Theta,Sig,lag=5)
Order of the ARMA mdoel:  
[1] 2 0
Standard deviation of forecast error:  
          [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
[1,] 0.5335970 0.5902949 0.6267952 0.6535902 0.6666530 0.6716619
[2,] 0.5400023 0.7164448 0.7694647 0.7794018 0.7826851 0.7838315
[3,] 0.5991486 0.7141959 0.7363465 0.7445789 0.7473451 0.7480486
Forecast-Error-Variance Decomposition 
Forecast horizon:  1 
           [,1]      [,2]      [,3]
[1,] 1.00000000 0.0000000 0.0000000
[2,] 0.00845528 0.9915447 0.0000000
[3,] 0.05473849 0.1686923 0.7765692
Forecast horizon:  2 
          [,1]       [,2]      [,3]
[1,] 0.9811542 0.01884579 0.0000000
[2,] 0.1466467 0.73368728 0.1196661
[3,] 0.2251607 0.19873371 0.5761056
Forecast horizon:  3 
          [,1]       [,2]        [,3]
[1,] 0.9276841 0.06876506 0.003550864
[2,] 0.1996736 0.66313799 0.137188439
[3,] 0.2305791 0.21070427 0.558716606
Forecast horizon:  4 
          [,1]       [,2]       [,3]
[1,] 0.8916501 0.09470853 0.01364134
[2,] 0.2039474 0.65624200 0.13981062
[3,] 0.2312793 0.21703145 0.55168924
Forecast horizon:  5 
          [,1]      [,2]       [,3]
[1,] 0.8758332 0.1043414 0.01982541
[2,] 0.2037927 0.6553521 0.14085523
[3,] 0.2314104 0.2185403 0.55004939
Forecast horizon:  6 
          [,1]      [,2]       [,3]
[1,] 0.8690834 0.1084458 0.02247087
[2,] 0.2038019 0.6547263 0.14147175
[3,] 0.2314182 0.2188607 0.54972110
```





